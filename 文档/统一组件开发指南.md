# 统一组件开发指南

## 🎯 核心原则

### 1. 统一配置优先
- ✅ **必须**：所有组件都使用统一的设计系统配置
- ✅ **必须**：优先使用现有的工具函数和Hook
- ❌ **禁止**：重复实现已有的功能
- ❌ **禁止**：硬编码颜色、字体、间距等样式值

### 2. 智能对比度系统
- ✅ **必须**：所有需要背景色和文字色的组件使用 `getOptimalTextColor`
- ✅ **必须**：按钮类组件使用 `SmartButton` 或智能对比度工具
- ❌ **禁止**：自定义对比度计算函数
- ❌ **禁止**：使用固定的文字颜色值

## 🛠️ 开发规范

### 按钮组件开发

#### ✅ 正确做法
```typescript
import { getOptimalTextColor } from "@/lib/contrast-utils"

export function MyButton({ backgroundColor, variant = 'primary' }) {
  const textColor = useMemo(() => 
    getOptimalTextColor(backgroundColor, variant), 
    [backgroundColor, variant]
  )
  
  return (
    <button 
      style={{ 
        backgroundColor, 
        color: textColor 
      }}
    >
      按钮文字
    </button>
  )
}
```

#### ❌ 错误做法
```typescript
// 不要这样做！
function getContrastColor(hexColor: string): string {
  // 自定义对比度计算逻辑
  return yiq >= 128 ? "#000000" : "#ffffff"
}

export function MyButton({ backgroundColor }) {
  const textColor = getContrastColor(backgroundColor) // 违反统一原则
  // ...
}
```

### 使用SmartButton组件

#### ✅ 推荐做法
```typescript
import { SmartButton } from "@/components/ui/smart-button"

export function MyComponent() {
  return (
    <SmartButton 
      customBackgroundColor="#FF6B6B"
      variant="primary"
    >
      智能按钮
    </SmartButton>
  )
}
```

### 使用统一设计令牌

#### ✅ 正确做法
```typescript
import { useDesignTokens } from "@/components/providers/design-tokens-provider"

export function MyComponent() {
  const { tokens } = useDesignTokens()
  
  return (
    <div 
      style={{ 
        backgroundColor: tokens.colors.primary,
        color: getOptimalTextColor(tokens.colors.primary, 'primary')
      }}
    >
      内容
    </div>
  )
}
```

#### ❌ 错误做法
```typescript
// 不要硬编码！
export function MyComponent() {
  return (
    <div 
      style={{ 
        backgroundColor: "#3b82f6", // 硬编码颜色
        color: "#ffffff" // 硬编码文字颜色
      }}
    >
      内容
    </div>
  )
}
```

## 🔍 约束检查流程

### 开发前检查
1. 查看现有组件库，优先复用
2. 检查是否有相关的工具函数
3. 确认设计令牌配置

### 开发中验证
```typescript
// 使用约束检查器
import { validateComponent } from "@/lib/component-constraint-checker"

const violations = validateComponent(MyComponent)
if (violations.length > 0) {
  console.warn('组件违反设计约束:', violations)
}
```

### 开发后测试
1. 测试不同主题下的表现
2. 验证智能对比度效果
3. 确保响应式设计正常

## 📋 常见违反约束的情况

### 1. 重复实现对比度计算
```typescript
// ❌ 违反约束
function getContrastColor(hexColor: string): string {
  // 自定义实现
}

// ✅ 正确做法
import { getOptimalTextColor } from "@/lib/contrast-utils"
```

### 2. 硬编码样式值
```typescript
// ❌ 违反约束
<div style={{ color: "#333333", fontSize: "14px" }}>

// ✅ 正确做法
<div className="text-gray-700 text-sm">
```

### 3. 不使用统一配置
```typescript
// ❌ 违反约束
const primaryColor = "#3b82f6"

// ✅ 正确做法
const { tokens } = useDesignTokens()
const primaryColor = tokens.colors.primary
```

## 🚀 最佳实践

### 1. 组件开发模板
```typescript
"use client"

import { useMemo } from "react"
import { cn } from "@/lib/utils"
import { getOptimalTextColor } from "@/lib/contrast-utils"
import { useDesignTokens } from "@/components/providers/design-tokens-provider"

interface MyComponentProps {
  variant?: 'primary' | 'secondary'
  backgroundColor?: string
  className?: string
}

export function MyComponent({ 
  variant = 'primary', 
  backgroundColor,
  className 
}: MyComponentProps) {
  const { tokens } = useDesignTokens()
  
  // 使用统一配置
  const bgColor = backgroundColor || tokens.colors.primary
  const textColor = useMemo(() => 
    getOptimalTextColor(bgColor, variant), 
    [bgColor, variant]
  )
  
  return (
    <div 
      className={cn("base-styles", className)}
      style={{ 
        backgroundColor: bgColor,
        color: textColor 
      }}
    >
      内容
    </div>
  )
}
```

### 2. 测试模板
```typescript
// 测试不同背景色下的表现
const testColors = ["#FF6B6B", "#4ECDC4", "#000000", "#FFFFFF"]

testColors.forEach(color => {
  const textColor = getOptimalTextColor(color, 'primary')
  // 验证对比度是否足够
  expect(checkWCAGContrast(color, textColor, 'AA')).toBe(true)
})
```

## 📚 相关资源

- [设计令牌系统文档](./设计系统与约束系统架构文档.md)
- [开发约束文档](./开发约束文档.md)
- [智能对比度工具源码](../lib/contrast-utils.ts)
- [SmartButton组件源码](../components/ui/smart-button.tsx)

## ⚠️ 注意事项

1. **向后兼容**：修改现有组件时确保不破坏现有功能
2. **性能考虑**：使用 `useMemo` 缓存计算结果
3. **类型安全**：确保所有props都有正确的TypeScript类型
4. **测试覆盖**：新组件必须有完整的测试用例

---

遵循这些指南，确保所有组件都符合统一设计规范，避免重复实现和违反约束的问题。
